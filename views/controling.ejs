<%- include('./partials/header') %> 
<%- include('./partials/nav') %> 

    <div class="content mt-4">
        
<link rel="stylesheet" href="css/style.css">
<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

<img src="images/ilus/gambar1.png" width="400" height="400" class="rounded mx-auto d-block" alt="...">
<h1 class="text-center h1">Controlling Panel</h1>
    <div class="p-3">
    <div class="row justify-content-center mt-5">
        <div class="card-deck">
          <div class="col-lg-6 mb-3">
          <div class="cardi text-center border-light " style="width: 100%;">
            <br>
            <div class="card-body">
              <div class="cardalem" >
                <div class="p-1">
                <h2 class="h4">Volume Air</h2>
                </div>
            </div>
            <br>
            <br>
            <div class="p-3">
                <form>
                    <div class="form-group">
                        <label class="h5">Your Current Water Volume</label>
                        <h1 class="h3"><span id="suhu"></span></h1>
                    </div>
                    <div class="form-group">
                        <label class="h5">Set Your Water Volume</label>
                        <input type="text" class="form-control">
                    </div>
                    <br><br><br />
                    <br><br><br><br>
                </form>
            </div>
        </div>
    </div>
</div>
<br>

            <div class="col-lg-6 mb-3">
            <div class="cardi text-center border-light" style="width: 100%;">
                <br>
                <div class="card-body">
                    <div class="cardalem" >
                        <div class="p-1">
                        <h5 class="h4">Ph Air</h5>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div class="p-4">
                        <form>
                            <div class="form-group">
                                <label class="h5">Your Current Water Ph</label>
                                <h1 class="h3"><span id="ph"></span></h1>
                            </div>
                            <div class="form-group">
                                <label class="h5">Set Your Water Ph</label><br /><br />
                                <div class="row">
                                    <div class="col">
                                      <div class="cardalem" >
                                        <div class="p-2">
                                        <h5 class="h4">Ph Up</h5>
                                        </div>
                                    </div>
                                      <br /><input type="text" class="form-control">
                                    </div>
                                    <div class="col">
                                      <div class="cardalem" >
                                        <div class="p-2">
                                        <h5 class="h4">Ph Down</h5>
                                        </div>
                                    </div>
                                        <br /><input type="text" class="form-control">
                                        <br /><br />
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>


    <div class="row justify-content-center">
        <div class="card-deck">
        <div class="col-lg-6 mb-3" >
          <div class="cardi text-center border-light" style="width: 100%;">
            <br>
            <div class="card-body">
                <div class="cardalem" >
                    <div class="p-1">
                    <h5 class="h4">Nutrition</h5>
                    </div>
                </div>
                <br>
                <br>
                <div class="p-4">
                    <form>
                        <div class="form-group">
                            <label class="h5">Your Current Nutrition</label>
                            <h1 class="h3"><span id="nutrisi"></span></h1>
                        </div>
                        <div class="form-group">
                            <label class="h5">Set Your Nutrition</label>
                            <input type="text" class="form-control">
                            <br>
                        </div>
                    </form>
                </div>
            </div>
          </div>
        </div>
        <br>
        <div class="col-lg-6 mb-3">
          <div class="cardi text-center border-light" style="width: 100%;">
            <br>
            <div class="card-body">
                <div class="cardalem" >
                    <div class="p-1">
                    <h5 class="h4">UV Light</h5>
                    </div>
                </div>
                <br>
                <br>
                <br>
                <div class="p-4">
                    <form>
                        <div class="form-group">
                            <br>
                            <br>
                            <input type="checkbox" checked data-toggle="toggle" data-onstyle="dark">
                        </div>
                    </form>
                    <br>
                    <br>
                    <br>
                    <br>
                </div>
            </div>
          </div>
        </div>
    </div>
</div>
      </div>
    </div>

    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script type="module">
        // import firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBSxBmGcM6_1uNPqWd5oPutkyQsZvrYVO0",
        authDomain: "hidropol-c0585.firebaseapp.com",
        databaseURL: "https://hidropol-c0585-default-rtdb.firebaseio.com",
        projectId: "hidropol-c0585",
        storageBucket: "hidropol-c0585.appspot.com",
        messagingSenderId: "436216931478",
        appId: "1:436216931478:web:040c4a8ec221f244e70eb7",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);

      // set status and ui
      const signin = document.querySelectorAll(".signin")
      const signout = document.querySelectorAll(".signout")
      onAuthStateChanged(auth, (user) => {
        if (user) {
          console.log("login");
          signin.forEach((item) => (item.style.display = "block",
          item.classList.toggle("d-inline-block")) )
          signout.forEach((item) => (item.style.display = "none") )
        } else {
          window.location = "/";
          console.log("no user");
          signin.forEach((item) => (item.style.display = "none") )
          signout.forEach((item) => (item.style.display = "block",
          item.classList.toggle("d-inline-block")) )
          window.location = "/";
        }
      });

      // Logout
      const logout = document.getElementById("logout");
      logout.addEventListener("click", (e) => {
        e.preventDefault();
        signOut(auth)
          .then(() => {
            console.log("berhasil logout");
            window.location = "/";
          })
          .catch((error) => {
            console.log("gagal logout");
            error;
          });
      });

      // read database
      const suhu = document.getElementById("suhu");
      const nutrisi = document.getElementById("nutrisi");
      const ph = document.getElementById("ph");
      const sinaruv = document.getElementById("sinaruv")
      const DHT11SensorData = ref(database, "DHT11SensorData");
      onValue(DHT11SensorData, (snapshot) => {
        suhu.innerHTML = snapshot.val().Suhu;
        nutrisi.innerHTML = snapshot.val().Nutrisi;
        ph.innerHTML = snapshot.val().Ph;
        sinaruv.innerHTML = snapshot.val().SinarUV;
        // console.log(`Berhasil membaca nutrisi ${snapshot.val().Nutrisi} dan suhu ${snapshot.val().Suhu},,${snapshot.val().Ketinggian},,${snapshot.val().Ph},,${snapshot.val().Ph}`)
      });
    </script>

  </body>
</html>
